services:
    appwrite:
        container_name: appwrite
        image: appwrite-dev
        build:
            context: ..
            args:
                DEBUG: false
                TESTING: false
                VERSION: dev
        networks:
            - appwrite
        labels:
            - "traefik.enable=true"
            - "traefik.constraint-label-stack=appwrite"
            - "traefik.docker.network=appwrite"
            - "traefik.http.services.appwrite_api.loadbalancer.server.port=80"
            #http
            - traefik.http.routers.appwrite_api_http.entrypoints=appwrite_web
            - traefik.http.routers.appwrite_api_http.rule=PathPrefix(`/`)
            - traefik.http.routers.appwrite_api_http.service=appwrite_api
            # https
            - traefik.http.routers.appwrite_api_https.entrypoints=appwrite_websecure
            - traefik.http.routers.appwrite_api_https.rule=PathPrefix(`/`)
            - traefik.http.routers.appwrite_api_https.service=appwrite_api
            - traefik.http.routers.appwrite_api_https.tls=true
        volumes:
            - appwrite-uploads:/storage/uploads:rw
            - appwrite-cache:/storage/cache:rw
            - appwrite-config:/storage/config:rw
            - appwrite-certificates:/storage/certificates:rw
            - appwrite-functions:/storage/functions:rw
            - appwrite-sites:/storage/sites:rw
            - appwrite-builds:/storage/builds:rw
            - ../phpunit.xml:/usr/src/code/phpunit.xml
            - ../tests:/usr/src/code/tests
            - ../app:/usr/src/code/app
            - ../docs:/usr/src/code/docs
            - ../public:/usr/src/code/public
            - ../src:/usr/src/code/src
            - ../dev:/usr/src/code/dev
        depends_on:
            - mariadb
            - redis
        entrypoint:
            - php
            - -e
            - app/http.php
        environment:
            - _APP_ENV
            - _APP_EDITION
            - _APP_WORKER_PER_CORE
            - _APP_LOCALE
            - _APP_COMPRESSION_MIN_SIZE_BYTES
            - _APP_CONSOLE_WHITELIST_ROOT
            - _APP_CONSOLE_WHITELIST_EMAILS
            - _APP_CONSOLE_SESSION_ALERTS
            - _APP_CONSOLE_WHITELIST_IPS
            - _APP_CONSOLE_HOSTNAMES
            - _APP_SYSTEM_EMAIL_NAME
            - _APP_SYSTEM_EMAIL_ADDRESS
            - _APP_SYSTEM_TEAM_EMAIL
            - _APP_EMAIL_SECURITY
            - _APP_SYSTEM_RESPONSE_FORMAT
            - _APP_OPTIONS_ABUSE
            - _APP_OPTIONS_ROUTER_PROTECTION
            - _APP_OPTIONS_FORCE_HTTPS
            - _APP_OPTIONS_COMPUTE_FORCE_HTTPS
            - _APP_OPENSSL_KEY_V1
            - _APP_DOMAIN
            - _APP_DOMAIN_TARGET
            - _APP_DOMAIN_FUNCTIONS
            - _APP_REDIS_HOST
            - _APP_REDIS_PORT
            - _APP_REDIS_USER
            - _APP_REDIS_PASS
            - _APP_DB_HOST
            - _APP_DB_PORT
            - _APP_DB_SCHEMA
            - _APP_DB_USER
            - _APP_DB_PASS
            - _APP_SMTP_HOST
            - _APP_SMTP_PORT
            - _APP_SMTP_SECURE
            - _APP_SMTP_USERNAME
            - _APP_SMTP_PASSWORD
            - _APP_USAGE_STATS
            - _APP_STORAGE_LIMIT
            - _APP_STORAGE_PREVIEW_LIMIT
            - _APP_STORAGE_ANTIVIRUS
            - _APP_STORAGE_ANTIVIRUS_HOST
            - _APP_STORAGE_ANTIVIRUS_PORT
            - _APP_STORAGE_DEVICE
            - _APP_STORAGE_S3_ACCESS_KEY
            - _APP_STORAGE_S3_SECRET
            - _APP_STORAGE_S3_REGION
            - _APP_STORAGE_S3_BUCKET
            - _APP_STORAGE_S3_ENDPOINT
            - _APP_STORAGE_DO_SPACES_ACCESS_KEY
            - _APP_STORAGE_DO_SPACES_SECRET
            - _APP_STORAGE_DO_SPACES_REGION
            - _APP_STORAGE_DO_SPACES_BUCKET
            - _APP_STORAGE_BACKBLAZE_ACCESS_KEY
            - _APP_STORAGE_BACKBLAZE_SECRET
            - _APP_STORAGE_BACKBLAZE_REGION
            - _APP_STORAGE_BACKBLAZE_BUCKET
            - _APP_STORAGE_LINODE_ACCESS_KEY
            - _APP_STORAGE_LINODE_SECRET
            - _APP_STORAGE_LINODE_REGION
            - _APP_STORAGE_LINODE_BUCKET
            - _APP_STORAGE_WASABI_ACCESS_KEY
            - _APP_STORAGE_WASABI_SECRET
            - _APP_STORAGE_WASABI_REGION
            - _APP_STORAGE_WASABI_BUCKET
            - _APP_COMPUTE_SIZE_LIMIT
            - _APP_COMPUTE_TIMEOUT
            - _APP_COMPUTE_BUILD_TIMEOUT
            - _APP_COMPUTE_CPUS
            - _APP_COMPUTE_MEMORY
            - _APP_FUNCTIONS_RUNTIMES
            - _APP_SITES_RUNTIMES
            - _APP_DOMAIN_SITES
            - _APP_EXECUTOR_SECRET
            - _APP_EXECUTOR_HOST
            - _APP_LOGGING_CONFIG
            - _APP_MAINTENANCE_INTERVAL
            - _APP_MAINTENANCE_RETENTION_EXECUTION
            - _APP_MAINTENANCE_RETENTION_CACHE
            - _APP_MAINTENANCE_RETENTION_ABUSE
            - _APP_MAINTENANCE_RETENTION_AUDIT
            - _APP_MAINTENANCE_RETENTION_USAGE_HOURLY
            - _APP_MAINTENANCE_RETENTION_SCHEDULES
            - _APP_SMS_PROVIDER
            - _APP_SMS_FROM
            - _APP_GRAPHQL_MAX_BATCH_SIZE
            - _APP_GRAPHQL_MAX_COMPLEXITY
            - _APP_GRAPHQL_MAX_DEPTH
            - _APP_VCS_GITHUB_APP_NAME
            - _APP_VCS_GITHUB_PRIVATE_KEY
            - _APP_VCS_GITHUB_APP_ID
            - _APP_VCS_GITHUB_WEBHOOK_SECRET
            - _APP_VCS_GITHUB_CLIENT_SECRET
            - _APP_VCS_GITHUB_CLIENT_ID
            - _APP_MIGRATIONS_FIREBASE_CLIENT_ID
            - _APP_MIGRATIONS_FIREBASE_CLIENT_SECRET
            - _APP_ASSISTANT_OPENAI_API_KEY
            - _APP_MESSAGE_SMS_TEST_DSN
            - _APP_MESSAGE_EMAIL_TEST_DSN
            - _APP_MESSAGE_PUSH_TEST_DSN
            - _APP_CONSOLE_COUNTRIES_DENYLIST
            - _APP_EXPERIMENT_LOGGING_PROVIDER
            - _APP_EXPERIMENT_LOGGING_CONFIG
            - _APP_DATABASE_SHARED_TABLES
            - _APP_DATABASE_SHARED_TABLES_V1
            - _APP_DATABASE_SHARED_NAMESPACE
            - _APP_FUNCTIONS_CREATION_ABUSE_LIMIT
